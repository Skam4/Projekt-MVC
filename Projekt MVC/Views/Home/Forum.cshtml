@model List<Projekt_MVC.Models.Dyskusja>

@{
    ViewData["Title"] = "Home Page";

    if (ViewBag.UserId == null)
    {
        Layout = "_LayoutNieZalogowany";
    }
    else
    {
        Layout = "_Layout";
    }
}

<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="~/css/Forum.css">
    <link rel="stylesheet" href="@ViewBag.CurrentSkinCssFilePath">
</head>
<body>

    <h1>Dyskusje:</h1>

    <form asp-controller="Home" asp-action="StworzDyskusje" method="post" onsubmit="return sprawdzLogowanie()">
        <button type="submit" class="StworzDyskusjeButton">Stwórz Dyskusję</button>
        <input type="hidden" name="ForumId" value="@ViewBag.ForumId" />
    </form>

    @if (Model == null || !Model.Any())
    {
        <p style="margin-top: 10px ; font-display:fallback ">Brak dyskusji na forum</p>
    }
    else
    {
        <div class="list-group">
            @foreach (var dyskusja in Model)
            {
                <div class="list-group-item">
                    <form method="post" asp-action="Dyskusja" asp-controller="Home">
                        <input type="hidden" name="id" value="@dyskusja.DyskusjaId">
                        <button class="list-group-item-action" type="submit">
                            @dyskusja.Temat,
                            Liczba odpowiedzi: @dyskusja.LiczbaOdpowiedzi,
                            Liczba odsłon: @dyskusja.LiczbaOdwiedzen
                        </button>
                    </form>

                    @if (ViewBag.Rola == "admin" || ViewBag.CzyMod == 1)
                    {
                        <form method="post" asp-action="UsunDyskusje" asp-controller="Admin" class="delete-form">
                            <input type="hidden" name="id" value="@dyskusja.DyskusjaId" />
                            <button type="submit" class="delete-button" onclick="confirmDelete(event)">Usuń</button>
                        </form>
                    }
                </div>
            }
        </div>
    }

    <script>
        function sprawdzLogowanie() {
            var isUserLoggedIn = @(ViewBag.UserId != null ? "true" : "false");

            if (!isUserLoggedIn) {
                window.location.href = '../../Rejestracja/Logowanie';
                return false;
            }

            return true;
        }

        function confirmDelete(event) {
            if (!confirm("Czy na pewno chcesz usunąć dyskusję?")) {
                event.preventDefault();
            }
        }
    </script>

</body>
</html>
