@model List<Projekt_MVC.Models.Dyskusja>

@{
    ViewData["Title"] = "Home Page";

    if (ViewBag.UserId == null)
    {
        Layout = "_LayoutNieZalogowany";
    }
    else
    {
        Layout = "_Layout";
    }
}

<h1> Dyskusje: </h1>

<html>
<form asp-controller="Home" asp-action="StwórzDyskusje" method="post" onsubmit="return sprawdzLogowanie()">
    <button type="submit" class="StworzDyskusje">Stwórz Dyskusję</button>
    <input type="hidden" name="ForumId" value="@ViewBag.ForumId" />
</form>
@if (Model == null)
{
    <p>Brak dyskusji na forum</p>
}
else
{
    <div class="list-group">
        @foreach (var dyskusja in Model)
        {

            <a href="/Home/Dyskusja/@dyskusja.DyskusjaId" class="list-group-item list-group-item-action">
                @dyskusja.Temat Opis: @dyskusja.Opis
                Liczba odpowiedzi: @(dyskusja.Odpowiedzi != null ? dyskusja.Odpowiedzi.Count : 0)
                Liczba odsłon: @dyskusja.LiczbaOdwiedzen
            </a>

            <div class="list-group-item">
                <a href="/Home/Dyskusja/@dyskusja.DyskusjaId" class="list-group-item-action">
                    @dyskusja.Temat
                

                @if (ViewBag.Rola == "admin")
                {
                    <form method="post" asp-action="UsunDyskusje" asp-controller="Admin" style="display: inline; margin-left: 200px">
                        <input type="hidden" name="id" value="@dyskusja.DyskusjaId" />
                        <button type="submit" class="red-button" onclick="f(event)">Usuń</button>
                    </form>
                }
                </a>
            </div>
        }
    </div>

}

</html>

<script>
    function sprawdzLogowanie() {
        var isUserLoggedIn = @(ViewBag.UserId != null ? "true" : "false");

        if (!isUserLoggedIn) {
            window.location.href = '../../Rejestracja/Logowanie';
            return false;
        }

        return true;
    }

function f(e) {
        if (!confirm("Czy na pewno chcesz usunąć dyskusję?")) {
            e.preventDefault();
        }
    }
</script>
